"use strict";(()=>{var e={};e.id=738,e.ids=[738],e.modules={2885:e=>{e.exports=require("@supabase/supabase-js")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},2048:e=>{e.exports=require("fs")},5315:e=>{e.exports=require("path")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,a){return a in t?t[a]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,a)):"function"==typeof t&&"default"===a?t:void 0}}})},6132:(e,t,a)=>{a.r(t),a.d(t,{config:()=>m,default:()=>f,routeModule:()=>g});var r={};a.r(r),a.d(r,{default:()=>p});var s=a(1802),i=a(7153),n=a(6249),l=a(2885),o=a(2048),d=a.n(o),c=a(5315),u=a.n(c);async function p(e,t){if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});try{let{city:a}=e.body;if(!a)return t.status(400).json({error:"City is required"});console.log(`🔍 Predicting properties for: ${a}`);let r="real_cre_data",s=[],i=function(e){let t=e.toLowerCase();return t.includes("dallas")||t.includes("fort worth")||t.includes("plano")||t.includes("frisco")||t.includes("irving")||t.includes("dfw")?"dfw":t.includes("phoenix")||t.includes("scottsdale")||t.includes("tempe")||t.includes("chandler")?"phx":t.includes("atlanta")||t.includes("marietta")||t.includes("alpharetta")?"atl":t.includes("riverside")||t.includes("san bernardino")||t.includes("ontario")||t.includes("inland empire")?"ie":t.includes("savannah")?"sav":"dfw"}(a);console.log(`📍 Market mapped: ${a} → ${i}`);try{let e=(0,l.createClient)("https://azwkiifefkwewruyplcj.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY);console.log("\uD83C\uDF10 Testing Supabase connection...");let{data:t,error:a}=await e.from("v_comps_trimmed").select("*").eq("market_slug",i).limit(5);if(!a&&t&&t.length>0)console.log(`✅ Supabase connected! Found ${t.length} records`),r="supabase_live",s=t.map(e=>({id:e.id,address:e.address,building_sf:e.building_sf,estimated_value:e.price_per_sf_usd*e.building_sf,cap_rate:e.cap_rate_pct,investment_score:_(e)}));else throw Error("No live data available")}catch(t){console.log("⚠️ Supabase unavailable, using REAL CRE data from file...");let e=function(){try{let e=u().join(process.cwd(),"real-cre-data.json"),t=d().readFileSync(e,"utf8");return JSON.parse(t)}catch(e){return console.warn("Could not load real CRE data:",e),null}}();if(e&&e.comparables[i]){let t=e.comparables[i];console.log(`📊 Using REAL ${i.toUpperCase()} market data (${t.length} properties)`),s=t.map((e,t)=>({id:e.id,address:e.address,building_sf:e.building_sf,estimated_value:e.price_per_sf_usd*e.building_sf,cap_rate:e.cap_rate_pct,investment_score:_(e,t)})),r="real_market_data"}else console.log("❌ No real data available for market:",i),s=[{id:`${i}-fallback-1`,address:`1200 Business Plaza, ${a}`,building_sf:185e3,estimated_value:28e6,cap_rate:7.8,investment_score:87},{id:`${i}-fallback-2`,address:`1500 Corporate Center, ${a}`,building_sf:225e3,estimated_value:32e6,cap_rate:7.2,investment_score:82},{id:`${i}-fallback-3`,address:`800 Industrial Way, ${a}`,building_sf:165e3,estimated_value:24e6,cap_rate:8.1,investment_score:79}],r="minimal_fallback"}s.sort((e,t)=>t.investment_score-e.investment_score);let n={success:!0,city:a,properties:s.slice(0,5),data_source:r};return console.log(`✅ Returning ${s.length} properties from ${r}`),t.status(200).json(n)}catch(e){return console.error("❌ API Error:",e),t.status(500).json({error:"Failed to predict properties"})}}function _(e,t=0){let a=50,r=e.cap_rate_pct||e.cap_rate;r>8.5?a+=25:r>7.5?a+=20:r>6.5?a+=15:r>5.5&&(a+=10),"A"===e.building_class?a+=25:"A-"===e.building_class?a+=20:"B+"===e.building_class?a+=15:"B"===e.building_class&&(a+=10),e.building_sf>25e4?a+=20:e.building_sf>2e5?a+=15:e.building_sf>15e4?a+=10:e.building_sf>1e5&&(a+=5),e.occupancy_pct>90?a+=15:e.occupancy_pct>85?a+=10:e.occupancy_pct>80&&(a+=5);let s=new Date().getFullYear()-(e.year_built||2010);return s<5?a+=10:s<10?a+=8:s<15&&(a+=5),Math.round(Math.min(100,Math.max(0,a+=Math.floor(5*Math.random())-2*t)))}let f=(0,n.l)(r,"default"),m=(0,n.l)(r,"config"),g=new s.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/predict-properties-real",pathname:"/api/predict-properties-real",bundlePath:"",filename:""},userland:r})},7153:(e,t)=>{var a;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return a}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(a||(a={}))},1802:(e,t,a)=>{e.exports=a(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var a=t(t.s=6132);module.exports=a})();